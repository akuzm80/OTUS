## Лабораторная работа. Настройка HSRP  
### Топология  
 
#### Таблица адресации (интерфейсы заменены на реальные из eve)   
| Устройство |  Интерфейс       | IP-адрес      | Маска подсети | Шлюз по умолчанию |  
|:---------- |:---------        |:--------:     |:-------------:|:-----------------:|   
|R1	         |E0/1   G0/1       |192.168.1.1    |255.255.255.0  |                  —|  
|R1          |S1/0 S0/0/0 (DCE )|10.1.1.1       |255.255.255.252|                  —|  
|R2	         |S1/0 S0/0/0       |10.1.1.2       |255.255.255.252|                  —|  
|R2          |S1/1 S0/0/1 (DCE) |10.2.2.2       |255.255.255.252|                  —|  
|R2          |Lo1               |209.165.200.225|255.255.255.224|	               —|  
|R3          |E0/1 G0/1         |192.168.1.3	|255.255.255.0	|                  —|  
|R3          |S1/1 S0/0/1       |10.2.2.1       |255.255.255.252|                  —|  
|S1	         |VLAN 1            |192.168.1.11   |255.255.255.0  |192.168.1.1        |  
|S3          |VLAN 1            |192.168.1.13   |255.255.255.0  |192.168.1.3        |  
|PC-A        |NIC               |192.168.1.31   |255.255.255.0  |192.168.1.1        |  
|PC-C        |NIC               |192.168.1.33   |255.255.255.0  |192.168.1.3        |   
###	Задачи
  
Часть 1. Построение сети и проверка соединения  
Часть 2. Настройка обеспечения избыточности на первом хопе с помощью HSRP
    
### Общие сведения / сценарий.       
Связующее дерево обеспечивает резервирование коммутаторами в локальной сети, не допуская возникновения петель. Но оно не позволяет организовать в сети резервирование шлюзов по умолчанию для устройств конечных пользователей на случай сбоя одного из маршрутизаторов. Протоколы обеспечения избыточности на первом хопе (First Hop Redundancy Protocols, FHRP) предоставляют избыточные шлюзы по умолчанию для конечных устройств. При этом конфигурация конечного пользователя не требуется. В этой лабораторной работе вам предстоит настроить протокол Cisco HSRP, являющийся протоколом FHRP.  

##### Примечание.  
   В практических лабораторных работах CCNA используются маршрутизаторы с интегрированными сетевыми сервисами (ISR) Cisco 1941 с операционной системой Cisco IOS версии 15.2(4)M3 (образ universalk9). Также используются коммутаторы Cisco Catalyst 2960 с операционной системой Cisco IOS версии 15.0(2) (образ lanbasek9). Можно использовать другие маршрутизаторы, коммутаторы и версии Cisco IOS. В зависимости от модели устройства и версии Cisco IOS доступные команды и результаты их выполнения могут отличаться от тех, которые показаны в лабораторных работах. Точные идентификаторы интерфейсов см. в сводной таблице по интерфейсам маршрутизаторов в конце лабораторной работы.  
  
##### Примечание.   

Убедитесь, что у маршрутизаторов и коммутаторов были удалены начальные конфигурации. Если вы не уверены, обратитесь к инструктору.
  
###	Необходимые ресурсы: 
 
-	3 маршрутизатора (Cisco 1941 с операционной системой Cisco IOS версии 15.2(4)M3 (универсальный образ) или аналогичная модель)  
-	2 коммутатора (Cisco 2960 с операционной системой Cisco IOS 15.0(2) (образ lanbasek9) или аналогичная модель)  
-	2 компьютера (Windows 8, 7 или Vista с программой эмуляции терминала, например Tera Term)  
-	Консольные кабели для настройки устройств Cisco IOS через консольные порты  
-	Кабели Ethernet и последовательные кабели согласно топологии
-	  
## Часть 1:	Построение сети и проверка связи
    
В первой части вам предстоит настроить топологию сети и выполнить базовую настройку, например IP-адреса   интерфейсов, статическую маршрутизацию, доступ к устройствам и пароли.  
  
### Шаг 1:	Создайте сеть согласно топологии.  

Подключите устройства, как показано в топологии, и подсоедините необходимые кабели.
### Шаг 2:	Настройте узлы ПК.  
### Шаг 3:	Выполните инициализацию и перезагрузку маршрутизатора и коммутаторов.  
### Шаг 4:	Произведите базовую настройку маршрутизаторов.  
- a.	Отключите поиск DNS.  
*no ip domain-lookup*
- b.	Присвойте имена устройствам в соответствии с топологией.  
*Hostname R1*
- c.	Настройте IP-адреса для маршрутизаторов, указанных в таблице адресации.  
*int s0/1*  
*ip address 10.1.1.1 255.255.255.252*  
- d.	Установите тактовую частоту на 128000 для всех последовательных интерфейсов маршрутизатора DCE.  
*clock rate 128000*  
- e.	Назначьте class в качестве зашифрованного пароля доступа к привилегированному режиму.  
*enable secret class*  
- f.	Назначьте cisco в качестве пароля консоли и VTY и включите запрос пароля при подключении.  
*line con 0*  
*password cisco*  
*login*  
*line vty 0 4*  
*password cisco*  
*login*   
- g.	Настройте logging synchronous, чтобы сообщения от консоли не могли прерывать ввод команд.  
*line con 0*  
*logging synchronous*  
- h.	Скопируйте текущую конфигурацию в файл загрузочной конфигурации.  
*copy running-config startup-config*    
### Шаг 5:	Настройте базовые параметры каждого коммутатора.  
- a.	Отключите поиск DNS.  
*no ip domain-lookup*
- b.	Присвойте имена устройствам в соответствии с топологией.  
*hostname S1*  
- c.	Назначьте class в качестве зашифрованного пароля доступа к привилегированному режиму.  
*enable secret class*  
- d.	Настройте IP-адреса для коммутаторов, указанных в таблице адресации.  
*int vlan 1*  
*ip address 192.168.1.11 255.255.255.0*  
*no sh*  
- e.	На каждом коммутаторе настройте шлюз по умолчанию.  
*ip default-gateway 192.168.1.1*    
- f.	Назначьте cisco в качестве пароля консоли и VTY и включите запрос пароля при подключении.  
*line con 0*
*password cisco*  
*login*  
*line vty 0 4*  
*password cisco*  
*login*  
- g.	Настройте logging synchronous, чтобы сообщения от консоли не могли прерывать ввод команд.  
*line con 0*  
*logging synchronous*  
- h.	Скопируйте текущую конфигурацию в файл загрузочной конфигурации.  
*copy running-config startup-config*      
### Шаг 6:	Проверьте подключение между PC-A и PC-C.      
Отправьте ping-запрос с компьютера PC-A на компьютер PC-C. Удалось ли получить ответ? *ДА*  
Если команды ping завершились неудачно и связь установить не удалось, исправьте ошибки в основных настройках устройства.    
##### Примечание.    
Для успешной передачи эхо-запросов может потребоваться отключение брандмауэра.    
### Шаг 7:	Настройте маршрутизацию.    
- a.	Настройте RIP версии 2 на всех маршрутизаторах. Добавьте в процесс RIP все сети, кроме 209.165.200.224/27.  
*router rip*  
*version 2*  
*network 192.168.1.0*  
*network 10.1.1.0*  
*network 10.2.2.0*  
- b.	Настройте маршрут по умолчанию на маршрутизаторе R2 с использованием Lo1 в качестве интерфейса выхода в сеть 209.165.200.224/27.  
*ip route 0.0.0.0 0.0.0.0 209.165.200.224*  
- c.	На маршрутизаторе R2 используйте следующие команды для перераспределения маршрута по умолчанию в процесс RIP.  
*R2(config)# router rip*  
*R2(config-router)# default-information originate*  
Проверить таблицу маршрутизации  
Show ip route  
Gateway of last resort is 209.165.200.224 to network 0.0.0.0  
  
S*    0.0.0.0/0 [1/0] via 209.165.200.224  
      10.0.0.0/8 is variably subnetted, 4 subnets, 2 masks  
C        10.1.1.0/30 is directly connected, Serial1/0  
L        10.1.1.2/32 is directly connected, Serial1/0  
C        10.2.2.0/30 is directly connected, Serial1/1  
L        10.2.2.2/32 is directly connected, Serial1/1  
R     192.168.1.0/24 [120/1] via 10.2.2.1, 00:00:11, Serial1/1  
                     [120/1] via 10.1.1.1, 00:00:10, Serial1/0  
      209.165.200.0/24 is variably subnetted, 2 subnets, 2 masks  
C        209.165.200.224/27 is directly connected, Loopback1  
L        209.165.200.225/32 is directly connected, Loopback1  
    
### Шаг 8:	Проверьте подключение.    
- a.	Необходимо получить ответ на ping-запросы с компьютера PC-A от каждого интерфейса на маршрутизаторах R1, R2 и R3, а также от компьютера PC-C. Удалось ли получить все ответы? *ДА от всех*  
Если команды ping завершились неудачно и связь установить не удалось, исправьте ошибки в основных настройках устройства.  
- b.	Необходимо получить ответ на ping-запросы с компьютера PC-C от каждого интерфейса на маршрутизаторах R1, R2 и R3, а также от компьютера PC-A. Удалось ли получить все ответы? *ДА от всех*  
Если команды ping завершились неудачно и связь установить не удалось, исправьте ошибки в основных настройках устройства.
  
## Часть 2:	Настройка обеспечения избыточности на первом хопе с помощью HSRP.  
Даже если топология спроектирована с учетом избыточности (два маршрутизатора и два коммутатора в одной сети LAN), оба компьютера, PC-A и PC-C, необходимо настраивать с одним адресом шлюза. PC-A использует R1, а PC-C — R3. В случае сбоя на одном из этих маршрутизаторов или интерфейсов маршрутизаторов компьютер может потерять подключение к сети Интернет.  
В части 2 вам предстоит изучить поведение сети до и после настройки протокола HSRP. Для этого вам понадобится определить путь, по которому проходят пакеты, чтобы достичь loopback-адрес на R2.  

### Шаг 1:	Определите путь интернет-трафика для PC-A и PC-C. 

 a).	В командной строке на PC-A введите команду tracert для loopback-адреса 209.165.200.225 на маршрутизаторе R2.  
C:\ tracert 209.165.200.225  
Tracing route to 209.165.200.225 over a maximum of 30 hops  
  
  1     1 ms     1 ms     1 ms  192.168.1.1  
  2    13 ms    13 ms    13 ms  209.165.200.225  
  
Trace complete.   
Какой путь прошли пакеты от PC-A до 209.165.200.225?  
*1   192.168.1.1   0.361 ms  0.349 ms  0.337 ms*  
*2*   **10.1.1.2   8.908 ms (ICMP type:3, code:3, Destination port unreachable)* *     
b).	В командной строке на PC-С введите команду tracert для loopback-адреса 209.165.200.225 на маршрутизаторе R2.    
Какой путь прошли пакеты от PC-C до 209.165.200.225?    
*1   192.168.1.3   0.370 ms  0.315 ms  0.342 ms*    
*2*   **10.2.2.2   8.839 ms (ICMP type:3, code:3, Destination port unreachable)*  *  
    
### Шаг 2:	Запустите сеанс эхо-тестирования на PC-A и разорвите соединение между S1 и R1.  
a).	В командной строке на PC-A введите команду ping –t для адреса 209.165.200.225 на маршрутизаторе R2. Убедитесь, что окно командной строки открыто. 
 
##### Примечание. Чтобы прервать отправку эхо-запросов, нажмите комбинацию клавиш Ctrl+C или закройте окно командной строки.  
  
*C:\ ping –t 209.165.200.225*  
*Pinging 209.165.200.225 with 32 bytes of data:*  
*Reply from 209.165.200.225: bytes=32 time=9ms TTL=254*  
*Reply from 209.165.200.225: bytes=32 time=9ms TTL=254*   
*Reply from 209.165.200.225: bytes=32 time=9ms TTL=254*  
<выходные данные опущены>
  
b).	В процессе эхо-тестирования отсоедините кабель Ethernet от интерфейса G0/1 и S0/0/0 на R1.   
Что произошло с трафиком эхо-запросов?  
*209.165.200.225 icmp_seq=95 timeout*  
  
c).	Какими были бы результаты при повторении шагов 2a и 2b на компьютере PC-C и роутере R3?  
*аналогичные, пинг не доходит до адресата*  

d).	Повторно подсоедините кабели Ethernet к интерфейсу G0/1 и S0/0/0 на R1 и G0/1 и S0/0/1 на R3, соответственно.   Повторно отправьте эхо-запросы на 209.165.200.225 с компьютеров PC-A и PC-C, чтобы убедиться в том, что подключение восстановлено.  

### Шаг 3:	Настройте HSRP на R1 и R3.  
  
В этом шаге вам предстоит настроить HSRP и изменить адрес шлюза по умолчанию на компьютерах PC-A, PC-C, S1 и коммутаторе S2 на виртуальный IP-адрес для HSRP. R1 назначается активным маршрутизатором с помощью команды приоритета HSRP.
  
a).	Настройте протокол HSRP на маршрутизаторе R1.  
*R1(config)# interface e0/1*  
*R1(config-if)# standby version 2*  
*R1(config-if)# standby 1 ip 192.168.1.254*  
*R1(config-if)# standby 1 priority 150*  
*R1(config-if)# standby 1 preempt*
  
b).	Настройте протокол HSRP на маршрутизаторе R3.  
*R3(config)# interface e0/1*  
*R3(config-if)# standby version 2*  
*R3(config-if)# standby 1 ip 192.168.1.254*  

c).	Проверьте HSRP, выполнив команду show standby на R1 и R3.  
*R1# show standby*  
*Ethernet0/1 - Group 1 (version 2)*  
  *State is Active*  
    *2 state changes, last state change 00:04:42*  
  *Virtual IP address is 192.168.1.254*  
  *Active virtual MAC address is 0000.0c9f.f001*  
    *Local virtual MAC address is 0000.0c9f.f001 (v2 default)*  
  *Hello time 3 sec, hold time 10 sec*  
    *Next hello sent in 1.488 secs*  
  *Preemption enabled*  
  *Active router is local*  
  *Standby router is 192.168.1.3, priority 100 (expires in 9.408 sec)*  
  *Priority 150 (configured 150)*  
  *Group name is "hsrp-Et0/1-1" (default)*  
*R3# show standby*  
*Ethernet0/1 - Group 1 (version 2)*  
  *State is Standby*  
    *1 state change, last state change 00:02:28*  
  *Virtual IP address is 192.168.1.254*  
  *Active virtual MAC address is 0000.0c9f.f001*  
    *Local virtual MAC address is 0000.0c9f.f001 (v2 default)*  
  *Hello time 3 sec, hold time 10 sec*  
    *Next hello sent in 1.728 secs*  
  *Preemption disabled*  
  *Active router is 192.168.1.1, priority 150 (expires in 11.408 sec)*  
    *MAC address is aabb.cc00.1010*  
  *Standby router is local*  
  *Priority 100 (default 100)*  
  *Group name is "hsrp-Et0/1-1" (default)*  
Используя указанные выше выходные данные, ответьте на следующие вопросы:  
Какой маршрутизатор является активным? *R1*  
Какой MAC-адрес используется для виртуального IP-адреса?  *0000.0c9f.f001*   
Какой IP-адрес и приоритет используются для резервного маршрутизатора?  
*Standby router is 192.168.1.3*   
*Priority 100 (default 100)*  
d).	Используйте команду show standby brief на R1 и R3, чтобы просмотреть сводку состояния HSRP. Выходные данные приведены ниже.  
*R1# show standby brief*  
     *P indicates configured to preempt.*    
                     |  
Interface   Grp  Pri P State   Active          Standby         Virtual IP  
Et0/1       1    150 P Active  local           192.168.1.3     192.168.1.254  
  
R3# show standby brief  
P indicates configured to preempt.  
                     |  
Interface   Grp  Pri P State   Active          Standby         Virtual IP  
Et0/1       1    100   Standby 192.168.1.1     local           192.168.1.254   
e).	Измените адрес шлюза по умолчанию для PC-A, PC-C, S1 и S3. Какой адрес следует использовать?  
*192.168.1.254*  
  
*ip default-gateway 192.168.1.254*  
*на PC    VPCS> ip 192.168.1.31/24 192.168.1.254*  
 *VPCS>show ip*    
f).	Проверьте новые настройки. Отправьте эхо-запрос с PC-A и с PC-C на loopback-адрес маршрутизатора R2. Успешно ли выполнены эхо-запросы?    
*ДА*  
    
### Шаг 4:	Запустите сеанс эхо-тестирования на PC-A и разорвите соединение с коммутатором, подключенным к активному маршрутизатору HSRP (R1).    
  
a).	В командной строке на PC-A введите команду ping –t для адреса 209.165.200.225 на маршрутизаторе R2. Убедитесь, что окно командной строки открыто.  
b).	Во время отправки эхо-запроса отсоедините кабель Ethernet от интерфейса e1/0 на коммутаторе S1 или выключите интерфейс e1/0.  
Что произошло с трафиком эхо-запросов?  
*Трафик ненадолго прервался и снова продолжился, произошло переключение на другой роутер HSPR (R3)*   

### Шаг 5:	Проверьте настройки HSRP на маршрутизаторах R1 и R3.   
 
a).	Выполните команду show standby brief на маршрутизаторах R1 и R3.  
Какой маршрутизатор является активным?  
 *оба*  
Повторно подключите кабель, соединяющий коммутатор и маршрутизатор, или включите интерфейс e1/0.    
Какой маршрутизатор теперь является активным? Поясните ответ.  
*R1, Его приоритет выше*  

### Шаг 6:	Изменение приоритетов HSRP.  
 
a).	Измените приоритет HSRP на 200 на маршрутизаторе R3. Какой маршрутизатор является активным?  
 *R3*  
b).	Выполните команду, чтобы сделать активным маршрутизатор R3 без изменения приоритета. Какую команду вы использовали?  
*standby 1 preempt*  
c).	Используйте команду show, чтобы убедиться, что R3 является активным маршрутизатором.  
  	
#### Вопросы для повторения

Для чего в локальной сети может потребоваться избыточность?  
*1) Для большей отказоустойчивости сети*  
*2) Для разгрузки сети с помощью перенаправления трафика по разным каналам*  
  	
### Сводная таблица по интерфейсам маршрутизаторов  
 
| Модель маршрутизатора | Интерфейс Ethernet № 1| Интерфейс Ethernet № 2 | Последовательный интерфейс № 1 |  Последовательный интерфейс № 2 |  
|1800                   | Fast Ethernet 0/0 (F0/0)|	Fast Ethernet 0/1 (F0/1) | Serial 0/0/0 (S0/0/0) | Serial 0/0/1 (S0/0/1)|  
|1900                   | Gigabit Ethernet 0/0 (G0/0)|	Gigabit Ethernet 0/1 (G0/1)|	Serial 0/0/0 (S0/0/0)| Serial 0/0/1 (S0/0/1)|    
|2801|Fast Ethernet 0/0 (F0/0)|	Fast Ethernet 0/1 (F0/1)|Serial 0/1/0 (S0/1/0)|	Serial 0/1/1 (S0/1/1)|    
|2811|Fast Ethernet 0/0 (F0/0)| Fast Ethernet 0/1 (F0/1)|Serial 0/0/0 (S0/0/0)| Serial 0/0/1 (S0/0/1)|    
|2900|Gigabit Ethernet 0/0 (G0/0)| Gigabit Ethernet 0/1 (G0/1)| Serial 0/0/0 (S0/0/0)| Serial 0/0/1 (S0/0/1)|  
  
#####Примечание.
 Чтобы определить конфигурацию маршрутизатора, можно посмотреть на интерфейсы и установить тип маршрутизатора и количество его интерфейсов. Перечислить все комбинации конфигураций для каждого класса маршрутизаторов невозможно. Эта таблица содержит идентификаторы для возможных комбинаций интерфейсов Ethernet и последовательных интерфейсов на устройстве. Другие типы интерфейсов в таблице не представлены, хотя они могут присутствовать в данном конкретном маршрутизаторе. В качестве примера можно привести интерфейс ISDN BRI. Строка в скобках — это официальное сокращение, которое можно использовать в командах Cisco IOS для обозначения интерфейса.
